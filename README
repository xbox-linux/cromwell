CROMWELL 1.9dev   2003-02-04
Xbox Linux Team

Contact: andy@warmcat.com, mist@c64.org. xboxlinux@meriac.de


What is Cromwell?

Cromwell is a clean BIOS for the Xbox.  Clean means that it is not
using any MS code.  Cromwell cannot launch native games, it can only
boot into Linux (or more correctly, a file vmlinuz which can
contain anything, but is usually the Linux kernel).

 - new 1024x576 automatic widescreen support (when widesceen was
   selected in MS native BIOS settings)
 - the ROM image is now 256KByte, works with all flashable modchips
 - single ROM compatible with v1.0 and v1.1 Xboxes
 - NEW 800x600 overscan-corrected video for PAL
 - ** No Microsoft code **  - a legal[1] alternative BIOS
 - auto-unlocks the HDD according to your EEPROM information
 - boots using MBR -> active partition -> reiserfs native loader,
   so it does not use LILO or GRUB, or keep any private HDD space.
 - Boot menu to change between /boot/linuxboot.cfg, /boot/vmlinuz, CD
   and a TBD Settings screen

LEGAL NOTE 1:

[1]Consult a lawyer if you want legal advice.  But we believe this BIOS
is immune to legal attack by MS as it contains none of their code and
won't even run native games

LEGAL NOTE 2:

This replacement BIOS will be used by most people in a flashable
modchip.  Up to now, MS might have argued that modchips are used
solely to hold hacked native BIOSes and are therefore somehow
illegal (still beats me why that would be, as each Xbox owner is
legitimately licensed to have a BIOS, if they choose to modify it,
just using the original or the modified version at any one time,
surely invalidating their warrenty should be the limit of MS's
comeback).  We would encourage manufacturers of flashable modchips
to ship their mods with this Linux Cromwell BIOS on them,
although probably they'll want to wait another version or two
for the next set of features.


OTHER NOTES

 - COMPOSITE cable only right now if you want the right colours
 - defaults to 800x600 for PAL boxes and 640x480 for NTSC boxes
 - if you have selected Widescreen in the native MS BIOS settings,
   then 1024x576 is selected with WSS if you are in PAL
 - in PAL, 640x480, 640x576 and 720x576 are also available



How to set up for booting Linux from BIOS on your Xbox
------------------------------------------------------

NOTE 1 - if you go back to a hacked or original BIOS, you will still
be able to boot Linux via CD as before, and play native games.

NOTE 2- do NOT blow this into a flash that you have no way of externally
reprogramming.  Reprogramming the BIOS is supported from within Linux
(via the raincoat app), but not from within the bootrom itself yet.  If
you don't successfully get Linux installed you will need to externally
reprogram your modchip to recover.

Installing Cromwell

1) Flash your modchip with image.bin

Installing Linux

1) Start up the xbox in Cromwell, insert the Mandrake 9 distro (from
http://xbox-linux.sf.net), or Ed's Debian distro
(from http://xbox-debian.linux.pt/ ) install CD.  Wait until the CD
is lit on the screen and close the tray

2) Linux will install, follow the instructions for your distro


Booting into Linux the first time

1) Follow the same procedure as above, this time with the boot CD
if your distro has one.  This provides just the Linux kernel and
initrd and the rest of the boot takes place from the HDD.

2) Once you are booted, copy vmlinuz and initrd from the boot CD
to /boot on the HDD.  For Mandrake it looks like this:

cp /mnt/cdrom/vmlinuz /boot
cp /mnt/cdrom/initrd /boot

3) shutdown your linux install


Booting into Linux subsequently

1) Just push the DVD tray shut as soon as the boot starts, this
will boot you quickly from your HDD


Compile-time options defaults

See config-rom.h

// selects between the supported video modes, see boot.h for enum listing those available
#define VIDEO_PREFERRED_LINES VIDEO_MODE_800x600

// uncomment to force CD boot mode even if MBR present
// default is to boot from HDD if MBR present, else CD
//#define FORCE_CD_BOOT

// display a line like Composite 480 detected if uncommented
#define REPORT_VIDEO_MODE

// show the MBR table if the MBR is valid
#define DISPLAY_MBR_INFO

// show simple menu selection
#define MENU

Todo

 - Get USB stack up in BIOS (<-- not looking forward to this)
 - BIOS flashing (code is present already)
 - Update to Mankdrake 9 installation CD set needed, so it copies
   vmlinuz and initrd to /boot by default
 - Ethernet code and stack


Improvements!

 - 1024x576 widescreen mode for PAL
 - 800x600 PAL mode!  Quite pleasant for browsing, etc.
 - works with v1.1 or v1.0
 - If the keyword no is used for an initrd in the linuxconf.cfg
   then no initrd will load from media
 - *NEW* ISO9660 native support in BIOS - If no MBR on HDD, boots from
   Mandrake 9 install CD to install Linux itself
 - *NEW* honours linuxboot.cfg if found in HDD /boot or CD
 - *NEW* extra compile-time options in config-rom.h
 - now capable of booting a Mandrake 9 Linux install by itself
 - VIDEO IS FULLY UP (Composite cable only) at boottime and
   inside Linux; works with Oliver's accellerated X driver (reserves
	 4MByte of RAM for video)


	 
Note: 1024x576 is NOT working with X yet.  But you can enjoy the 128x36
console mode on your widescreen TV :-)


Here are three /etc/X11/XF86Config-4 which work with Oliver's video driver.
Unfortunately you must match the right file to the right resolution:

---------------------------------------------------------------------------------
For 640 x 576 boot, use the following XF86Config-4:


Section "Files"
    RgbPath "/usr/X11R6/lib/X11/rgb"
    FontPath "unix/:7100"			# local font server

    # if the local font server has problems, we can fall back on these
    FontPath "/usr/lib/X11/fonts/misc"
    FontPath "/usr/lib/X11/fonts/cyrillic"
    FontPath "/usr/lib/X11/fonts/100dpi/:unscaled"
    FontPath "/usr/lib/X11/fonts/75dpi/:unscaled"
    FontPath "/usr/lib/X11/fonts/Type1"
    FontPath "/usr/lib/X11/fonts/Speedo"
    FontPath "/usr/lib/X11/fonts/100dpi"
    FontPath "/usr/lib/X11/fonts/75dpi"
EndSection

Section "Module"
    # Load	"GLcore"
    Load "bitmap"

    # Load	"dbe"
    # Load	"ddc"
    # Load	"dri"
    # Load	"extmod"
    Load "freetype"

    # Load	"glx"
    # Load	"int10"
    # Load	"fb"
    # Load	"pex5"
    # Load	"record"
    # Load	"speedo"
    Load "type1"

    # Load	"vbe"
    # Load	"xie"

    Subsection "extmod"
        Option "omit XFree86-DGA"
    EndSubsection
EndSection

Section "InputDevice"
    Identifier "Generic Keyboard"
    Driver "keyboard"
    Option "XkbModel" "pc104"
    Option "XkbLayout" "us"
    Option "CoreKeyboard"
    Option "XkbRules" "xfree86"
EndSection

Section "InputDevice"
    Identifier "Configured Mouse"
    Driver "mouse"
    Option "Protocol" "PS/2"
    Option "Device" "/dev/input/mouse0"
    Option "Emulate3Buttons" "true"
    Option "CorePointer"
    Option "ZAxisMapping" "4 5"
EndSection

Section "Device"
    Identifier "Framebuffer"
    Driver "fbdev"
    Option "UseFBDev"
    Option "fbdev" "/dev/fb/0"
EndSection

Section "Device"
    Identifier "Nv"
    Driver "nv"
    Option "NoAccel" "1"
    Option "UseFBDev" "1"
    Option "HWCursor" "0"
EndSection

Section "Modes"
    Identifier "default"
    Modeline "640x480" 30.72  640 672 752 832  576 580 584 600 -hsync -vsync
EndSection

Section "Monitor"
    Identifier "Generic Monitor"
    HorizSync 30-86
    VertRefresh 50-130
    UseModes "default"
    Option "DPMS"
EndSection

Section "Screen"
    Identifier "Default Screen"
    Device "Nv"
    Monitor "Generic Monitor"
    DefaultColorDepth 16

    Subsection "Display"
        Depth 8
        Modes "640x480"
    EndSubsection

    Subsection "Display"
        Depth 15
        Modes "640x480"
    EndSubsection

    Subsection "Display"
        Depth 16
        Modes "640x480"
    EndSubsection

    Subsection "Display"
        Depth 24
        Modes "640x480"
    EndSubsection

    DefaultDepth 24
EndSection

Section "ServerLayout"
    Identifier "Default Layout"
    InputDevice "Generic Keyboard"
    InputDevice "Configured Mouse"
    Screen "Default Screen"
EndSection

Section "DRI"
    Mode 0666
EndSection
### END DEBCONF SECTION

Section "ServerFlags"
    Option "PciForceConfig2" "false"
    Option "AllowMouseOpenFail" "true"
    Option "PciOsConfig" "true"
    Option "PciForceConfig1" "false"
    Option "PciProbe1" "false"
    Option "PciProbe2" "false"
EndSection



---------------------------------------------------------------------------------
For 640 x 480 boot, use the following XF86Config-4:

Section "Files"
    RgbPath "/usr/X11R6/lib/X11/rgb"
    FontPath "unix/:7100"			# local font server

    # if the local font server has problems, we can fall back on these
    FontPath "/usr/lib/X11/fonts/misc"
    FontPath "/usr/lib/X11/fonts/cyrillic"
    FontPath "/usr/lib/X11/fonts/100dpi/:unscaled"
    FontPath "/usr/lib/X11/fonts/75dpi/:unscaled"
    FontPath "/usr/lib/X11/fonts/Type1"
    FontPath "/usr/lib/X11/fonts/Speedo"
    FontPath "/usr/lib/X11/fonts/100dpi"
    FontPath "/usr/lib/X11/fonts/75dpi"
EndSection

Section "Module"
    # Load	"GLcore"
    Load "bitmap"

    # Load	"dbe"
    # Load	"ddc"
    # Load	"dri"
    # Load	"extmod"
    Load "freetype"

    # Load	"glx"
    # Load	"int10"
    # Load	"fb"
    # Load	"pex5"
    # Load	"record"
    # Load	"speedo"
    Load "type1"

    # Load	"vbe"
    # Load	"xie"

    Subsection "extmod"
        Option "omit XFree86-DGA"
    EndSubsection
EndSection

Section "InputDevice"
    Identifier "Generic Keyboard"
    Driver "keyboard"
    Option "XkbModel" "pc104"
    Option "XkbLayout" "us"
    Option "CoreKeyboard"
    Option "XkbRules" "xfree86"
EndSection

Section "InputDevice"
    Identifier "Configured Mouse"
    Driver "mouse"
    Option "Protocol" "PS/2"
    Option "Device" "/dev/input/mouse0"
    Option "Emulate3Buttons" "true"
    Option "CorePointer"
    Option "ZAxisMapping" "4 5"
EndSection

Section "Device"
    Identifier "Framebuffer"
    Driver "fbdev"
    Option "UseFBDev"
    Option "fbdev" "/dev/fb/0"
EndSection

Section "Device"
    Identifier "Nv"
    Driver "nv"
    Option "NoAccel" "1"
    Option "UseFBDev" "1"
    Option "HWCursor" "0"
EndSection

Section "Modes"
    Identifier "default"
    Modeline "640x480" 30.72  640 672 752 832  480 580 584 600 -hsync -vsync
EndSection

Section "Monitor"
    Identifier "Generic Monitor"
    HorizSync 30-86
    VertRefresh 50-130
    UseModes "default"
    Option "DPMS"
EndSection

Section "Screen"
    Identifier "Default Screen"
    Device "Nv"
    Monitor "Generic Monitor"
    DefaultColorDepth 16

    Subsection "Display"
        Depth 8
        Modes "640x480"
    EndSubsection

    Subsection "Display"
        Depth 15
        Modes "640x480"
    EndSubsection

    Subsection "Display"
        Depth 16
        Modes "640x480"
    EndSubsection

    Subsection "Display"
        Depth 24
        Modes "640x480"
    EndSubsection

    DefaultDepth 24
EndSection

Section "ServerLayout"
    Identifier "Default Layout"
    InputDevice "Generic Keyboard"
    InputDevice "Configured Mouse"
    Screen "Default Screen"
EndSection

Section "DRI"
    Mode 0666
EndSection
### END DEBCONF SECTION

Section "ServerFlags"
    Option "PciForceConfig2" "false"
    Option "AllowMouseOpenFail" "true"
    Option "PciOsConfig" "true"
    Option "PciForceConfig1" "false"
    Option "PciProbe1" "false"
    Option "PciProbe2" "false"
EndSection




---------------------------------------------------------------------------------
For 800 x 600 boot, use the following XF86Config-4:

Section "Files"
    RgbPath "/usr/X11R6/lib/X11/rgb"
    FontPath "unix/:7100"			# local font server

    # if the local font server has problems, we can fall back on these
    FontPath "/usr/lib/X11/fonts/misc"
    FontPath "/usr/lib/X11/fonts/cyrillic"
    FontPath "/usr/lib/X11/fonts/100dpi/:unscaled"
    FontPath "/usr/lib/X11/fonts/75dpi/:unscaled"
    FontPath "/usr/lib/X11/fonts/Type1"
    FontPath "/usr/lib/X11/fonts/Speedo"
    FontPath "/usr/lib/X11/fonts/100dpi"
    FontPath "/usr/lib/X11/fonts/75dpi"
EndSection

Section "Module"
    # Load	"GLcore"
    Load "bitmap"

    # Load	"dbe"
    # Load	"ddc"
    # Load	"dri"
    # Load	"extmod"
    Load "freetype"

    # Load	"glx"
    # Load	"int10"
    # Load	"fb"
    # Load	"pex5"
    # Load	"record"
    # Load	"speedo"
    Load "type1"

    # Load	"vbe"
    # Load	"xie"

    Subsection "extmod"
        Option "omit XFree86-DGA"
    EndSubsection
EndSection

Section "InputDevice"
    Identifier "Generic Keyboard"
    Driver "keyboard"
    Option "XkbModel" "pc104"
    Option "XkbLayout" "us"
    Option "CoreKeyboard"
    Option "XkbRules" "xfree86"
EndSection

Section "InputDevice"
    Identifier "Configured Mouse"
    Driver "mouse"
    Option "Protocol" "PS/2"
    Option "Device" "/dev/input/mouse0"
    Option "Emulate3Buttons" "true"
    Option "CorePointer"
    Option "ZAxisMapping" "4 5"
EndSection

Section "Device"
    Identifier "Framebuffer"
    Driver "fbdev"
    Option "UseFBDev"
    Option "fbdev" "/dev/fb/0"
EndSection

Section "Device"
    Identifier "Nv"
    Driver "nv"
    Option "NoAccel" "1"
    Option "UseFBDev" "1"
    Option "HWCursor" "0"
EndSection

Section "Modes"
    Identifier "default"
    Modeline "640x480" 30.72  640 672 752 832  480 580 584 600 -hsync -vsync
EndSection

Section "Monitor"
    Identifier "Generic Monitor"
    HorizSync 30-86
    VertRefresh 50-130
    UseModes "default"
    Option "DPMS"
EndSection


Section "Screen"
    Identifier "Default Screen"
    Device "Nv"
    Monitor "Generic Monitor"
    DefaultColorDepth 16

    Subsection "Display"
        Depth 8
        Modes "800x600"
    EndSubsection

    Subsection "Display"
        Depth 15
        Modes "800x600"
    EndSubsection

    Subsection "Display"
        Depth 16
        Modes "800x600"
    EndSubsection

    Subsection "Display"
        Depth 24
        Modes "800x600"
    EndSubsection

    DefaultDepth 24
EndSection

Section "ServerLayout"
    Identifier "Default Layout"
    InputDevice "Generic Keyboard"
    InputDevice "Configured Mouse"
    Screen "Default Screen"
EndSection

Section "DRI"
    Mode 0666
EndSection
### END DEBCONF SECTION

Section "ServerFlags"
    Option "PciForceConfig2" "false"
    Option "AllowMouseOpenFail" "true"
    Option "PciOsConfig" "true"
    Option "PciForceConfig1" "false"
    Option "PciProbe1" "false"
    Option "PciProbe2" "false"
EndSection






