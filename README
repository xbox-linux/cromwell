CROMWELL 1.8   2003-01-21
Xbox Linux Team

Contact: andy@warmcat.com, mist@c64.org. xboxlinux@meriac.de

-----------
IMPORTANT... Don't run this code without backing up your EEPROM
contents somehow first.  Its been quite stable, but it if it
blows a fuse and craps over your eeprom, don't blame us.
-----------

What is Cromwell?

Cromwell is a clean BIOS for the Xbox.  Clean means that it is not
using any MS code.  Cromwell cannot launch native games, it can only
boot into Linux (or more correctly, a file vmlinuz which can
contain anything, but is usually the Linux kernel).

 - the ROM image is now 256KByte, works with all flashable modchips
   !! ---> now single ROM compatible with v1.0 and v1.1 Xboxes <-- !!
 - ** No Microsoft code **  - a legal[1] alternative BIOS
 - auto-unlocks the HDD according to your EEPROM information
 - boots using MBR -> active partition -> reiserfs native loader,
   so it does not use LILO or GRUB, or keep any private HDD space.
 - Boot menu to change between /boot/linuxboot.cfg, /boot/vmlinuz, CD
   and a TBD Settings screen

LEGAL NOTE 1:

[1]Consult a lawyer if you want legal advice.  But we believe this BIOS
is immune to legal attack by MS as it contains none of their code and
won't even run native games

LEGAL NOTE 2:

This replacement BIOS will be used by most people in a flashable
modchip.  Up to now, MS might have argued that modchips are used
solely to hold hacked native BIOSes and are therefore somehow
illegal (still beats me why that would be, as each Xbox owner is
legitimately licensed to have a BIOS, if they choose to modify it,
just using the original or the modified version at any one time,
surely invalidating their warrenty should be the limit of MS's
comeback).  We would encourage manufacturers of flashable modchips
to ship their mods with this Linux Cromwell BIOS on them,
although probably they'll want to wait another version or two
for the next set of features.


Limitations

 - COMPOSITE cable only right now if you want the right colours
 - choice between 640x480 overscan-corrected, or 640x576 with default
    overscan at the moment (see config-rom.h)



How to set up for booting Linux from BIOS on your Xbox
------------------------------------------------------

NOTE 1 - if you go back to a hacked or original BIOS, you will still
be able to boot Linux via CD as before, and play native games.

NOTE 2- do NOT blow this into a flash that you have no way of externally
reprogramming.  Reprogramming the BIOS is supported from within Linux
(via the raincoat app), but not from within the bootrom itself yet.  If
you don't successfully get Linux installed you will need to externally
reprogram your modchip to recover.

Installing Cromwell

1) Flash your modchip with image.bin

Installing Linux

1) Start up the xbox in Cromwell, insert the Mandrake 9 distro (from 
http://xbox-linux.sf.net), or Ed's Debian distro 
(from http://xbox-debian.linux.pt/ ) install CD.  Wait until the CD
is lit on the screen and close the tray

2) Linux will install, follow the instructions for your distro


Booting into Linux the first time

1) Follow the same procedure as above, this time with the boot CD
if your distro has one.  This provides just the Linux kernel and
initrd and the rest of the boot takes place from the HDD.

2) Once you are booted, copy vmlinuz and initrd from the boot CD 
to /boot on the HDD.  For Mandrake it looks like this:

cp /mnt/cdrom/vmlinuz /boot
cp /mnt/cdrom/initrd /boot

3) shutdown your linux install


Booting into Linux subsequently

1) Just push the DVD tray shut as soon as the boot starts, this
will boot you quickly from your HDD


Compile-time options defaults

See config-rom.h

// selects between the supported video modes, both PAL at the moment
#define VIDEO_PREFERRED_LINES 576
//#define VIDEO_PREFERRED_LINES 480

// uncomment to force CD boot mode even if MBR present
// default is to boot from HDD if MBR present, else CD
//#define FORCE_CD_BOOT

// display a line like Composite 480 detected if uncommented
#define REPORT_VIDEO_MODE

// show the MBR table if the MBR is valid
#define DISPLAY_MBR_INFO

// show simple menu selection
#define MENU

Todo

 - Get USB stack up in BIOS (<-- not looking forward to this)
 - BIOS flashing (code is present already)
 - Update to Mankdrake 9 installation CD set needed, so it copies
   vmlinuz and initrd to /boot by default
 - Ethernet code and stack

Improvements!

 - works with v1.1 or v1.0
 - If the keyword no is used for an initrd in the linuxconf.cfg
   then no initrd will load from media
 - *NEW* ISO9660 native support in BIOS - If no MBR on HDD, boots from
   Mandrake 9 install CD to install Linux itself
 - *NEW* honours linuxboot.cfg if found in HDD /boot or CD
 - *NEW* extra compile-time options in config-rom.h
 - now capable of booting a Mandrake 9 Linux install by itself
 - VIDEO IS FULLY UP (Composite cable only) at boottime and
   inside Linux; works with Oliver's accellerated X driver (reserves
	 4MByte of RAM for video)
